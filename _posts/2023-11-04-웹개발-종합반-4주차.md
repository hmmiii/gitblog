---
title: 웹개발 종합반 4주차
author: hmmi
date: 2023-11-04 00:00
categories: [항해99,웹개발종합반]
tags: [항해99,웹개발종합반]
pin: true
toc: true
toc_sticky: true
---
## 4주차 배운내용

DB에 대해서 배우고, PYTHON에서 DB를 쿼리가 아닌 명령어로 다룰 수 있는 ORM의 종류인 Flask-SQLAlchemy을 다루는 방법을 배웠다.

## DB의 종류

### RDBMS(SQL)

- RDBMS(SQL), 전통적인 SQL. 
- 행/열의 생김새가 정해진 Excel에 데이터를 저장하는 것과 유사,
- 데이터 50만 개가 적재된 상태에서, 갑자기 중간에 열을 하나 더하기는 어려움.
- 정형화되어 있는 만큼, 데이터의 일관성이나 / 분석에 용이할 수 있습니다.
- ex) SQLite, MS-SQL, My-SQL 등

### NoSQL

- 딕셔너리 형태로 데이터를 저장해두는 Database입니다.
- 데이터 하나 하나 마다 같은 값들을 가질 필요가 없다.
- 자유로운 형태의 데이터 적재에 유리한 대신, 일관성이 부족할 수 있음
- ex) MongoDB

## SQLite

- 작지만 빠르고 탄탄하므로 SQLite는 세계에서 가장 많이 사용되는 데이터베이스 중 하나.
- Python에는 기본적으로 SQLite가 내장되어 있으므로 별도 설치 없이 VScode에서 `파일이름.db` 형식으로 파일을 만들기만 하면 손쉽게 사용할 수 있음.
- SQLite와 같은 데이터베이스에서 데이터를 다루기 위해서는 보통 SQL을 사용해야 하는데, ORM을 사용하면 프로그래밍 언어로 SQL을 다를 수 있음.
- Python Flask에서 사용하는 ORM은 Flask-SQLAlchemy

## Flask-SQLAlchemy

### 설치

```bash
pip install Flask-SQLAlchemy
```

### 폴더 구조
```
DB
|— venv
|— app.py (서버)
|— database.db (데이터베이스)
```

### 테이블 생성

```py
from flask import Flask
import os
from flask_sqlalchemy import SQLAlchemy

basedir = os.path.abspath(os.path.dirname(__file__))
app = Flask(__name__)
app.config['SQLALCHEMY_DATABASE_URI'] =\
        'sqlite:///' + os.path.join(basedir, 'database.db')

db = SQLAlchemy(app)

class Song(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String, nullable=False)
    artist = db.Column(db.String, nullable=False)
    title = db.Column(db.String, nullable=False)
    image_url = db.Column(db.String, nullable=False)

    def __repr__(self):
        return f'{self.artist} {self.title} 추천 by {self.username}'

with app.app_context():
    db.create_all()
```

지금 설계도에 `Class Song` 이라고 되어 있으니까,  Song 이라는 이름의 시트가 만들어진다. 이게 테이블.

필요한 데이터는 추천자(username), 가수(artist), 노래 제목(title), 포스터 주소(image_url) 데이터를 사용하기 때문에 위와 같이 코드를 작성.

쉽게 설명하자면 Excel 파일의 시트를 만드는 거로 생각.

Class를 만들어서 Column들을 만들고, 모아서 테이블을 만듭니다. `db.creat_all()`이 테이블 생성 메서드.

### Row 추가

```py
song = Song(username="추천자", title="노래제목", 
            artist="가수", image_url="이미지 주소")
db.session.add(song)
db.session.commit()
변수에 테이블명으로 작명한 클래스명의 인스턴스를 생성
```

add()메서드와 cmmit()메서드를 사용합니다. git과 비슷한 순서로 데이터를 추가

### 테이블 전체 조회

```py
class Song(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String, nullable=False)
    artist = db.Column(db.String, nullable=False)
    title = db.Column(db.String, nullable=False)
    image_url = db.Column(db.String, nullable=False)

    def __repr__(self):
        return f'{self.artist} {self.title} 추천 by {self.username}'
```

테이블이름.query.all() 을 실행하면 Database에 있는 모든 데이터를 조회 가능

데이터 표시 형식은 우리가 class Song에서 설정해둔 대로 나옴

### Row 별로 조회

```py
song_list = Song.query.all()
song_list[0] # 가수:노래제목 추천 by 추천자
```

파이썬 리스트 형식으로 row를 가져오기 가능.

1번 데이터를 가져옴.

```py
song_list[0].title # 노래 제목
```

파이썬 딕셔너리를 사용하듯 특정 column만 조회도 가능

### 특정 조건으로 데이터 조회

```py
Song.query.filter_by(username='추천자').all()
# [가수:노래제목 추천 by 추천자, 가수1:노래제목1 추천 by 추천자]
Song.query.filter_by(조건).all()을 사용하면 조건에 맞는 데이터를 전부 가져올 수 있음.

Song.query.filter_by(id=3).first() # 가수2:노래제목2 추천 by 스파르타
Song.query.filter_by(title='노래제목').first() # 가수:노래제목 추천 by 추천자
```

원하는 데이터를 1개 가져오려면 .first() 를 써주시면 됨

### 데이터 수정

```py
song_data = Song.query.filter_by(id=4).first()
song_data.title = '변경된제목'

db.session.add(song_data)
db.session.commit()
```

데이터를 가져오고, 파이썬에서 변수의 값을 변경하는 것처럼 수정하면  된다.

수정 사항을 반영하기 위해서는 꼭 add() 와 db.session.commit() 을 해줘야 한다.

### 데이터 삭제

```py
delete_data = Song.query.filter_by(id=4).first()
db.session.delete(delete_data)
db.session.commit()
```

데이터 수정과 마찬가지로 데이터 1개를 들고 온 다음 db.session.delete()로 삭제를 해줘야 한다.

수정과 마찬가지로 db.session.commit() 을 해야 한다.